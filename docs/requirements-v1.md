# 📄 家庭数字记忆盒 — 页面跳转与用户流程需求文档（V2）

**版本**：1.0  
**目标**：明确各页面之间的跳转逻辑与用户旅程，确保体验流畅、情感连贯、操作无感  
**设计原则**：  
- 以「成长手账」为中心枢纽  
- 最小化页面跳转，优先使用状态切换与浮层  
- 所有交互服务于“温柔记录”与“安心回看”的情感体验  

---

## 一、整体用户旅程概览

用户从首页开始记录，保存后自动进入成长手账页。编辑和分享操作尽量不离开手账上下文，避免迷失。

主要流程如下：

- 首页 `/` →（开始记录）→ 上传+AI生成+编辑（同页面状态切换）  
- 编辑完成 → 自动跳转至 `/memories`（成长手账）  
- 在 `/memories` 中：  
  - 点击“轻轻改一改” → 弹出编辑浮层（不跳转）  
  - 点击“寄明信片” → 跳转至 `/share?memoryId=xxx`  
- 从 `/share` 可返回 `/memories`  
- 从 `/memories` 也可返回首页 `/` 开始新记录

---

## 二、页面定义与跳转规则

### 1. 首页（Home）

- **URL**：`/`  
- **核心功能**：引导用户开始记录或查看历史  
- **关键元素**：
  - 主标题：“留下今天的闪光时刻 ✨”
  - 主按钮：“添加今天的闪光时刻”
  - 引导链接：“或看看我们的成长手账 →”

#### 跳转规则：

| 用户操作 | 目标页面/状态 | 说明 |
|--------|--------------|------|
| 点击「添加今天的闪光时刻」 | 进入上传+编辑态（仍在 `/`） | 页面 UI 切换为上传/编辑视图，不跳转新路由 |
| 点击「看看我们的成长手账」 | 跳转至 `/memories` | 进入成长手账页 |

---

### 2. 上传 → AI生成 → 编辑流程（一体化）

- **URL**：仍为 `/`（通过前端状态管理）  
- **流程阶段**：
  1. **上传态**：显示文件选择器
  2. **生成态**：显示“正在为你写下今天的温柔… 🌼”
  3. **编辑态**：展示照片 + 可编辑日记 + 「存进我们的成长手账」按钮

#### 跳转规则：

| 用户操作 | 目标页面/状态 | 说明 |
|--------|--------------|------|
| 上传成功 → AI 生成完成 | 切换至编辑态（同页面） | 自动聚焦文本框，允许修改 |
| 点击「存进我们的成长手账」 | 跳转至 `/memories` | 自动高亮最新一条记录，强化“已收藏”感 |
| 编辑过程中点浏览器返回 | 回到首页初始态 | 丢弃未保存内容（无确认弹窗） |

> 💡 技术建议：用 React 状态（如 `view: 'home' | 'editing'`）控制 UI 切换。

---

### 3. 成长手账页（Memories）

- **URL**：`/memories`  
- **核心功能**：回看、编辑、分享所有记忆  
- **关键元素**：
  - 标题：“我们的成长手账 📖”
  - 统计：“已记录 X 个闪光日子 · 一起走过的第 Y 天”
  - 记录列表（最新在上）
  - 每条记录含：“轻轻改一改” + “寄明信片”按钮
  - 顶部快捷入口：“添加今天的闪光时刻”

#### 跳转规则：

| 用户操作 | 目标页面/状态 | 说明 |
|--------|--------------|------|
| 点击「添加今天的闪光时刻」 | 跳转至 `/` | 返回首页开始新记录 |
| 点击「轻轻改一改」 | 弹出编辑浮层 | 浮层覆盖当前页，不跳转 |
| 点击「寄明信片」 | 跳转至 `/share?memoryId=xxx` | 进入明信片预览页 |
| 点击浏览器返回键 | 返回上一页面 | 若从首页进入，则回首页；若从分享页进入，则回分享页 |

---

### 4. 编辑浮层（Modal）

- **URL**：无（组件级浮层）  
- **触发方式**：点击手账页中某条记录的“轻轻改一改”  
- **功能**：修改日记文字，保存或取消

#### 跳转规则：

| 用户操作 | 目标页面/状态 | 说明 |
|--------|--------------|------|
| 点击「保存」 | 关闭浮层，刷新当前记录 | 数据持久化到 localStorage |
| 点击「取消」或遮罩层 | 关闭浮层，不保存 | 丢弃修改 |
| 按 Esc 键 | 关闭浮层 | 符合用户直觉 |

---

### 5. 明信片预览页（Share Preview）

- **URL**：`/share?memoryId=xxx`  
- **核心功能**：展示可分享的明信片样式，支持下载  
- **关键元素**：
  - 明信片视觉（照片 + 日记 + 日期 + 落款）
  - 主按钮：“寄给未来的我们”（触发下载）
  - 底部链接：“返回成长手账”

#### 跳转规则：

| 用户操作 | 目标页面/状态 | 说明 |
|--------|--------------|------|
| 点击「寄给未来的我们」 | 触发图片下载 | 使用 `html2canvas` 生成 PNG 并保存 |
| 点击「返回成长手账」 | 跳转至 `/memories` | 回到手账页 |
| 直接关闭页面 | 无副作用 | 该页无状态，关闭即消失 |

---

## 三、全局导航与返回逻辑

| 场景 | 行为 |
|------|------|
| **无顶部导航栏** | 避免破坏沉浸感，靠情感化按钮引导 |
| **浏览器返回键** | 遵循直觉：<br>- 编辑浮层 → 关闭浮层<br>- 分享页 → 回手账页<br>- 手账页 → 回首页（若从首页进入） |
| **所有跳转加过渡动画** | 使用淡入淡出或轻微滑动，模拟“翻页”感 |

---

## 四、异常与边界情况处理

| 场景 | 处理方式 |
|------|--------|
| AI 生成失败 | 在首页显示友好提示：“唔…这张照片有点害羞，能再换一张吗？” + 重试按钮 |
| 用户清空 localStorage | 成长手账页自动变为“空状态”，引导重新开始 |
| 分享页 URL 被直接访问（无效 memoryId） | 跳转回 `/memories` 并提示“记忆未找到” |

---

## 五、技术实现建议

- **路由方案**：Next.js App Router  
  - `/page.tsx` → 首页（含上传/编辑态）  
  - `/memories/page.tsx` → 成长手账页  
  - `/share/page.tsx` → 明信片预览页（读取 `searchParams.memoryId`）
- **状态管理**：  
  - 首页内部状态用 `useState`（`view`, `currentMemory`）  
  - 全局数据用 `localStorage` + 自定义 Hook（如 `useMemories`）
- **动画**：CSS `opacity` + `transform` 过渡，或轻量 `framer-motion`

---

## 六、成功标准

- [ ] 用户从开始记录到保存，**不超过 3 次点击**  
- [ ] 保存后**自动进入成长手账**，并感知到“记忆被收藏”  
- [ ] 编辑与分享操作**无需离开手账页上下文**  
- [ ] 所有跳转**有视觉反馈**（如按钮微动效、页面淡入）  
- [ ] **无用户迷失感**：任何时候都知道“我在哪”“怎么回去”

---

> 🌟 **记住**：这不是一个“功能流程”，而是一段**温柔的亲子时光旅程**。  
> 每一次跳转，都该像轻轻翻过一页手账——安静、自然、充满期待。

---  
**文档撰写**：AI 助手 × 你  
**最后更新**：2024年6月  
**下一步**：根据此文档开发页面路由与状态逻辑 ✨